"use strict";define(["Zepto","service","utils","wxClient","Zepto.touch","wangEditor"],function(a,b,c,d){var e={title:projTitle,link:d.getOauthUrl("http://m.fundin.cn/pay/"+projId),imgUrl:projImgUrl},f={title:projTitle,desc:a("#projDesc").val(),link:d.getOauthUrl("http://m.fundin.cn/pay/"+projId),imgUrl:projImgUrl};d.isInWeixin&&(b.getJsApiConfig({url:window.location.href},function(a){d.wxConfig(a)}),d.wxConfigReady(function(){d.shareTimeline(e),d.shareAppMessage(f)})),a(".cate-list span").on("click",function(){a(this).siblings().removeClass("selected"),a(this).attr("class","selected")});var g=parseInt(window.projSubject);3==g||4==g?a("[data-type-s='"+g+"']").addClass("selected"):a('[data-type-s="1"]').addClass("selected");var h=parseInt(window.projRepayWay);1==h||2==h?a("[data-type-w='"+h+"']").addClass("selected"):a("[data-type-w='0']").addClass("selected"),a("#cover_img").on("change",function(){var b=new FormData,c=a("#cover_img")[0].files;b.append("imgFile",c[0]),a.ajax({url:"/uploadImage",type:"POST",data:b,cache:!1,contentType:!1,processData:!1,success:function(b){b.code&&(a("#coverImg").attr("src",b.data).show(),a("#cover_img_v").val(b.data))}})}),""!=a("#coverImg").attr("src")&&a(".cover").html("<img src='"+a("#coverImg").attr("src")+"'>");var i=new ___E("wang");i.config.menus=["head","bold","color","quote","list","check"],i.init(),""!=projContent&&i.$txt.html(projContent);var j=function(){a(".repay_img").unbind("change"),a(".remove-x").unbind("click"),a("#repay_img").on("change",function(){var b=new FormData,c=a("#repay_img")[0].files;b.append("imgFile",c[0]),a.ajax({url:"/uploadImage",type:"POST",data:b,cache:!1,contentType:!1,processData:!1,success:function(b){b.code&&(a("#repayImg").attr("src",b.data).show(),a("#repay_img_v").val(b.data))}})}),a(".remove-x").on("click",function(){showOperation("确定删除该图片？",function(a){var b=a.elem;b.siblings(".img-entity").attr("src",""),b.parent().hide()},{elem:a(this)})})};j(),a("#draft-btn").on("click",function(){var d=a("input[name=projAmount]").val(),e=/^[1-9]\d{0,4}$/;if(""!=d&&!e.test(d))return void c.showToastMsg("请输入正整数","warn");var f=/^[1-9]\d{0,1}$/,g=a("input[name=projDays]").val();if(""!=g){if(!f.test(g))return void c.showToastMsg("请输入正整数","warn");if(parseInt(g)>60)return void c.showToastMsg("项目周期不能超过60天","warn")}var h=a("input[name=repayDays]").val();if(""!=h){if(!f.test(h))return void c.showToastMsg("请输入正整数","warn");if(parseInt(h)>60)return void c.showToastMsg("回报发放不能超过60天","warn")}var j=i.$txt.html(),k={title:a("input[name=projTitle]").val(),intro:a("textarea[name=projIntro]").val(),subject:a("#type span.selected").attr("data-type-s"),content:j,coverImg:a("#cover_img_v").val(),totalAmount:d,days:g,repayDays:h,repayWay:a("#way span.selected").attr("data-type-w"),repayContent:a("textarea[name=repay_text]").val(),repayImage:a("#repay_img_v").val()};projId&&(k.id=projId),b.saveDraft(k,function(a){c.showToastMsg("草稿保存成功")})}),a("#startup-btn").on("click",function(){b.hasPersonalInfo({},function(d){if(d){var e=a("input[name=projTitle]").val();if(""==e)return void c.showToastMsg("请填写标题","warn");var f=a("textarea[name=projIntro]").val();if(""==f)return void c.showToastMsg("请填写简介","warn");var g=a("#cover_img_v").val();if(""==g)return void c.showToastMsg("请选择封面图片","warn");var h=a("input[name=projAmount]").val(),j=/^[1-9]\d{0,4}$/;if(!j.test(h))return void c.showToastMsg("请输入正整数","warn");var k=/^[1-9]\d{0,1}$/,l=a("input[name=projDays]").val();if(!k.test(l))return void c.showToastMsg("请输入正整数","warn");if(parseInt(l)>60)return void c.showToastMsg("项目周期不能超过60天","warn");var m=a("input[name=repayDays]").val();if(!k.test(m))return void c.showToastMsg("请输入正整数","warn");if(parseInt(m)>60)return void c.showToastMsg("回报发放不能超过60天","warn");a("#startup-btn").attr("disabled",!0);var d={title:e,intro:f,subject:a("#type span.selected").attr("data-type-s"),content:i.$txt.html(),coverImg:g,totalAmount:h,days:l,repayDays:m,repayWay:a("#way span.selected").attr("data-type-w"),repayContent:a("textarea[name=repay_text]").val(),repayImage:a("#repay_img_v").val()};projId&&(d.id=projId),b.startNew(d,function(a){c.showToastMsg("项目发起成功, 请等待审核"),setTimeout(function(){window.location="/user/"+loginUserId},1e3)})}else c.showToastMsg("请先到个人页面完善个人资料后再发起项目","warn")})})});